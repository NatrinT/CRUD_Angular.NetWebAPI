<div class="d-flex h-100 px-3">
  <div class="sidebar p-3 border-end" style="width: 250px">
    <h4 class="mb-4">YOURLOGO</h4>
    <ul class="nav flex-column">
      <li class="nav-item">
        <a class="nav-link text-dark active" routerLink="."
          ><i class="bi bi-speedometer2 me-2"></i> Dashboard</a
        >
      </li>
      <li class="nav-item">
        <a class="nav-link text-dark" routerLink="."><i class="bi bi-people-fill me-2"></i> Users</a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-dark" routerLink="."
          ><i class="bi bi-file-earmark-text me-2"></i> Documents</a
        >
      </li>
      <li class="nav-item">
        <a class="nav-link text-dark" routerLink="."><i class="bi bi-image me-2"></i> Photos</a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-dark" routerLink="."><i class="bi bi-diagram-3 me-2"></i> Hierarchy</a>
      </li>
      <li class="nav-item mt-4">
        <a class="nav-link text-dark" routerLink="."><i class="bi bi-chat-dots me-2"></i> Message</a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-dark" routerLink="."><i class="bi bi-question-circle me-2"></i> Help</a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-dark" routerLink="."><i class="bi bi-gear-fill me-2"></i> Setting</a>
      </li>
    </ul>
  </div>

  <div class="main-content bg-light flex-grow-1 p-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h4 class="mb-0">Hello, {{currentUserName()}}</h4>
        <p class="text-muted">Have a nice day</p>
      </div>
      <div class="d-flex align-items-center">
        <i class="fa-solid fa-bell me-3 fs-5"></i>|
        <i class="bi bi-bell-fill me-3 fs-5 text-muted"></i>
        <img
          src="https://cdn-icons-png.flaticon.com/512/552/552721.png"
          alt="User Avatar"
          class="rounded-circle me-2"
          width="40"
        />

        <div class="dropdown" ngbDropdown>
          <button
            class="btn btn-light dropdown-toggle d-flex align-items-center"
            type="button"
            ngbDropdownToggle
            aria-expanded="false"
          >
            <div class="text-start flex-grow-1" style="margin-right: 10px;">
              {{ currentUserName() }}
              <br /><small class="text-muted">{{ currentUserRole() }}</small>
            </div>
          </button>
          <ul ngbDropdownMenu class="dropdown-menu">
            <li><a class="dropdown-item" (click)="onLogout()">Logout</a></li>
          </ul>
        </div>
      </div>
    </div>

    <h2 class="mb-4 text-primary">Users Dashboard</h2>

    <div class="mb-4 row">
      <div class="col-8">
        <div class="input-group">
          <span
            class="input-group-text py-3 px-4 rounded-start-pill text-right"
            style="border-right: none; background-color: #fff"
          >
            <i class="fa-solid fa-magnifying-glass"></i>
          </span>
          <input
            type="text"
            class="form-control py-3 px-0 rounded-end-pill"
            placeholder="Search"
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearch()"
            style="border-left: none"
          />
        </div>
      </div>
      <div class="col-4 d-flex justify-content-end align-items-center">
        <button class="btn btn-primary me-2" (click)="onAddUser()">
          Add user&nbsp;<i class="fa-solid fa-plus fs-9"></i>
        </button>

        <div class="btn-group me-2" ngbDropdown>
          <button
            type="button"
            class="btn btn-light dropdown-toggle"
            ngbDropdownToggle
            aria-expanded="false"
          >
            Sort by
          </button>
          <ul ngbDropdownMenu class="dropdown-menu">
            <li><a class="dropdown-item" routerLink=".">Name (A-Z)</a></li>
            <li><a class="dropdown-item" routerLink=".">Date (Newest)</a></li>
          </ul>
        </div>

        <button class="btn btn-light me-2"><i class="bi bi-bookmark-fill"></i> Saved search</button>
        <button class="btn btn-light"><i class="fa-solid fa-sliders"></i></button>
      </div>
    </div>

    <div class="card shadow-sm rounded-4 overflow-hidden">
      <div class="card-header bg-white py-3">
        <h5 class="mb-0">List Users</h5>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="bg-info-subtle">
              <tr>
                <th scope="col" class="text-start py-3 px-4 border-0" style="width: 30%">Name</th>
                <th scope="col" class="text-center border-0" style="width: 10%"></th>
                <th scope="col" class="text-center border-0" style="width: 25%">Create Date</th>
                <th scope="col" class="text-start border-0" style="width: 25%">Role</th>
                <th scope="col" class="text-center border-0" style="width: 10%">Action</th>
              </tr>
            </thead>
            <tbody>
              @for (user of users(); track user.id) {
              <tr
                app-user-item
                [user]="user"
                (delete)="onUserDelete($event)"
                (edit)="onUserEdit($event)"
              ></tr>
              } @empty {
              <tr>
                <td colspan="5" class="text-center py-4">No users found.</td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="card-footer d-flex justify-content-between align-items-center py-3">
      <div class="d-flex align-items-center">
        <span class="me-2">Items per page:</span>
        <select class="form-select form-select-sm w-auto" (change)="onPageSizeChange($event)">
          <option value="6" [selected]="pageSize() === 6">6</option>
          <option value="10" [selected]="pageSize() === 10">10</option>
          <option value="20" [selected]="pageSize() === 20">20</option>
        </select>
      </div>

      <div class="d-flex align-items-center">
        @if (totalCount() > 0) {
        <span class="me-3">
          {{ (currentPage() - 1) * pageSize() + 1 }}
          -
          {{ currentDisplayEnd() }}
          of {{ totalCount() }}
        </span>
        } @else {
        <span class="me-3">0 of 0</span>
        }

        <button
          class="btn btn-light btn-sm me-2"
          [disabled]="currentPage() === 1"
          (click)="onPageChange(currentPage() - 1)"
        >
          <i class="fa-solid fa-arrow-left"></i>
        </button>

        <button
          class="btn btn-light btn-sm"
          [disabled]="currentPage() === totalPagesCalc()"
          (click)="onPageChange(currentPage() + 1)"
        >
          <i class="fa-solid fa-arrow-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>

@if (showUserForm()) {
<app-user-form (formSubmitted)="handleFormSubmitted($event)"></app-user-form>
}

@if (showUserEditForm() && editingUserId()) {
    <app-edit-user-modal 
        [userId]="editingUserId()!" 
        (formSubmitted)="handleFormEditSubmitted($event)" 
    />
}